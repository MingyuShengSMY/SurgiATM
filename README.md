# SurgiATM: A Physics-Guided Plug-and-Play Model for Deep Learning-Based Smoke Removal in Laparoscopic Surgery

[Mingyu Sheng](https://scholar.google.com/citations?user=P7MIBuMAAAAJ&hl=en&oi=ao)<sup>1</sup>,
[Jianan Fan](https://ieeexplore.ieee.org/author/37090057230)<sup>1</sup>,
[Dongnan Liu](https://scholar.google.com/citations?hl=en&user=JZzb8XUAAAAJ)<sup>1</sup>,
[Guoyan Zheng](https://scholar.google.com/citations?user=n01L0mEAAAAJ&hl=en&oi=ao)<sup>2</sup>,
[Ron Kikinis](https://scholar.google.com/citations?user=n01L0mEAAAAJ&hl=en&oi=ao)<sup>3</sup>,
[Weidong Cai](https://scholar.google.com/citations?hl=en&user=N8qTc2AAAAAJ)<sup>1</sup>

<sup>1</sup> [The University of Sydney](https://www.sydney.edu.au/), 
<sup>2</sup> [Shanghai Jiao Tong University](https://hms.harvard.edu/),
<sup>3</sup> [Harvard Medical School](https://hms.harvard.edu/)

## ğŸ“„Paper Link
TMI: [TODO](http://)

Arxiv: [https://arxiv.org/abs/2511.05059](https://arxiv.org/abs/2511.05059)

## ğŸ–¼ï¸Concept Figure
![](assest/Natural_MIS_Error_Comparison.png)


## ğŸ’»Setup
* Recommended Environment: Python 3.12.0+, Cuda 12.0+
* Install dependencies: `pip install -r requirements.txt`.

## ğŸ“¦Dataset Directory
```
./dataset
 Â Â  â””â”€â”€ DatasetName
 Â Â      â”œâ”€â”€ GT
 Â Â      â”‚Â Â  â”œâ”€â”€ videoName1
 Â Â      â”‚Â Â  |Â Â  â”œâ”€â”€ frameName1.png
 Â Â      â”‚Â Â  |Â Â  â””â”€â”€ frameName2.png
 Â Â      â”‚Â Â  â””â”€â”€ videoName2
 Â Â      â””â”€â”€ X
 Â Â       Â Â  â”œâ”€â”€ videoName1
 Â Â       Â Â  |Â Â  â”œâ”€â”€ frameName1.png
 Â Â       Â Â  |Â Â  â””â”€â”€ frameName2.png
 Â Â       Â Â  â””â”€â”€ videoName2

```
A demo dataset is prepared and is named "demo_data".


`GT`: Smokeless frames.

`X`: Smoky Frames.


## ğŸ’¨Generate Simulated Smoke

**Warning**: It will overwrite the files in `X`.

```bash
cd prepare_data
python generate_smoke_syn.py --dataset_name DatasetName
```

Paired simulated smoky images will be generated by reading images in `GT` and writing them in `X`. 


## ğŸ”¤Data Splitting

```bash
cd prepare_data
python split_dataset.py --dataset_name [DatasetName]
```

`--dataset_name` is compulsorily required. Replacing `[DatasetName]` with `demo_data` can split the demo dataset. 

It will generate a folder `data_split` under the `./dataset/DatasetName`.

By default, the generated folder structure should be: 

```
./dataset/DatasetName/data_split
 Â Â  â”œâ”€â”€ 1
    |   â”œâ”€â”€ train.txt
    |   â””â”€â”€ val.txt
    â”œâ”€â”€ 2
    â”œâ”€â”€ 3
    â”œâ”€â”€ 4
    â”œâ”€â”€ 5
    â””â”€â”€ all.txt
```

The folders `1`, `2`, ..., and `5` indicate different folds in K-Fold Cross-Validation.

`train.txt` and `val.txt` store paths of training data and validating data, respectively.

`all.txt` contains all samples, particularly for Dark Channel Prior (DCP), because DCP does not need training.

Or, you can manually set the `txt` files.

## âš™ï¸Config File

Config files are stored in `./ConfigFiles`. The config file defines the experiment configuration, such as training epoch, learning rate, dataset, etc..


## â¯ï¸Run

1. Click to download datasets [Cholec80](http://camma.u-strasbg.fr/datasets/), [VASST-desmoke](https://github.com/wxia43/DesmokeData), and the [Hamlyn Dataset](https://hamlyn.doc.ic.ac.uk/vision/).

2. Arrange the data by following the [Dataset Directory](#Dataset-Directory).

3. [Generate simulated smoke](#Generate-Simulated-Smoke) for un-paired datasets.

4. [Split data](#Data-Splitting).

5. Adjust config files as needed.

6. Start running:

```bash
python main.py --config_file ConfigFiles/demo1.yaml --train --test --vis
```

`--train` and `--test` will start training and testing mode, respectively. At least one of them should be used.

`--vis` will visualize results in `--test` mode.

7. By default, folders `./log` and `./output` will be created to store loss log and output resul,t respectively.


## ğŸ“Citation

TMI: 

```
TODO
```


arXiv:

```
@misc{sheng2025surgiatmphysicsguidedplugandplaymodel,
      title={SurgiATM: A Physics-Guided Plug-and-Play Model for Deep Learning-Based Smoke Removal in Laparoscopic Surgery}, 
      author={Mingyu Sheng and Jianan Fan and Dongnan Liu and Guoyan Zheng and Ron Kikinis and Weidong Cai},
      year={2025},
      eprint={2511.05059},
      archivePrefix={arXiv},
      primaryClass={cs.CV},
      url={https://arxiv.org/abs/2511.05059}, 
}
```















